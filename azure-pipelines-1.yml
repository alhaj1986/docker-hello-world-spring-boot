trigger:
- main

pool:
  name: 'selfhosted'

variables:
- group: javapoc  # Link to the 'javapoc' Variable Group

steps:
- checkout: self
  displayName: 'Checkout source code'

- task: SonarQubePrepare@7
  inputs:
    SonarQube: 'awssonarserver'
    scannerMode: 'other'

- script: |
    export JAVA_HOME=/usr/lib/jvm/java-11-amazon-corretto.aarch64
    export PATH=$JAVA_HOME/bin:$PATH
  displayName: 'Set JAVA_HOME'

- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    mavenOptions: '-Xmx3072m'
    javaHomeOption: 'Path'
    jdkUserInputPath: '/usr/lib/jvm/java-11-amazon-corretto.aarch64'
    goals: 'clean install sonar:sonar'
